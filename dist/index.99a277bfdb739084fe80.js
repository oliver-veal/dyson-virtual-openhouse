(self.webpackChunkdyson_virtual_openhouse=self.webpackChunkdyson_virtual_openhouse||[]).push([[826],{3352:(e,t,s)=>{"use strict";var i=s(2212);class n{Add(e){this.game=e,this.Init()}Remove(){}Init(){}}class o{constructor(){this.listeners={},this.uniqueId=0}RegisterEventListener(e,t,s){this.listeners[e]||(this.listeners[e]={});let i=this.uniqueId;return this.uniqueId++,this.listeners[e][i]={context:t,listener:s},i}DeregisterEventListener(e,t){this.listeners[e]&&(this.listeners[e][t]?delete this.listeners[e][t]:console.log("Failed to remove id: "+t))}Trigger(e,t){this.listeners[e]&&Object.keys(this.listeners[e]).forEach((s=>{let i=this.listeners[e][s];i&&i.listener.call(i.context,t)}))}}var r=s(2050),a=s(6426),h=s(5980),c=s(2088),l=s(5441);class d extends n{Init(){this.renderScene=new a.C(this.game.scene,this.game.camera),this.fxaaPass=new h.T(l.C),this.SetFXAAPixelRatio=()=>{const e=this.game.renderer.getPixelRatio();this.fxaaPass.material.uniforms.resolution.value.x=1/(this.game.container.offsetWidth*e),this.fxaaPass.material.uniforms.resolution.value.y=1/(this.game.container.offsetHeight*e)},this.SetFXAAPixelRatio(),this.outlinePass=new c.f(new i.FM8(window.innerWidth,window.innerHeight),this.game.scene,this.game.camera),this.outlinePass.edgeThickness=3,this.outlinePass.edgeStrength=10,this.composer=new r.x(this.game.renderer),this.composer.addPass(this.renderScene),this.composer.addPass(this.outlinePass),this.composer.addPass(this.fxaaPass),window.addEventListener("resize",(()=>{const e=window.innerWidth,t=window.innerHeight;this.composer.setSize(e,t),this.SetFXAAPixelRatio()})),this.game.events.RegisterEventListener("OnObjectMouseOver",this,(({object:e,objects:t})=>{this.outlinePass.selectedObjects=t||[e]})),this.game.events.RegisterEventListener("OnObjectMouseLeave",this,(()=>{this.outlinePass.selectedObjects=[]}))}Update(){this.composer.render()}}var m=s(9483),g=s(7047),u=s(338);class p extends n{constructor(e){super(),this.ASSET_VERSION=e}Init(){m.config({name:"misc_load_file_storage",storeName:"three_cache"}),m.keys().then((e=>{e.forEach((e=>{e.includes("assets")&&!e.includes(this.GetAssetPath())&&(console.log("removing "+e),m.removeItem(e))}))})).catch((function(e){console.log(e)})),i.CtF.enabled=!0,i.CtF.add=(e,t,s)=>{m.setItem(e,t,s)},i.CtF.get=(e,t)=>m.getItem(e,((s,i)=>{null===i?t(void 0):(this.game.events.Trigger("AssetCacheHit",{key:e}),t(i))})),i.CtF.remove=(e,t)=>{m.removeItem(e,t)},i.CtF.clear=()=>{m.clear()},this.glassMaterial=new i.EJi({color:8738,metalness:0,roughness:0,alphaTest:.5,envMapIntensity:1,depthWrite:!1,transmission:.85,opacity:.5,transparent:!0}),this.Load(new i.cBK,v(this.GetAssetPath()+"skybox/",".jpg"),(e=>{this.game.scene.background=e,this.glassMaterial.envMap=e,this.game.envMapTexture=e,this.game.events.Trigger("OnLoadSkybox",{texture:e})}),null,(e=>console.error(e)));let e=this;const t=new g.E,s=new u._;s.setDecoderPath("/draco/"),s.setDecoderConfig({}),s.setWorkerLimit(4),t.setDRACOLoader(s),this.Load(t,this.GetAssetPath()+"scene.glb",(t=>{this.game.events.Trigger("WorldLoadProgress",{progress:100});let n=[];t.scene.traverse((function(t){t.isMesh&&(t.material.map&&(t.material.map.generateMipmaps=!1,t.material.map.magFilter=i.wem,t.material.map.minFilter=i.wem,t.material.map.encoding=i.rnI),t.userData&&t.userData.name&&(t.userData.name.includes("collision")?(n.push(t),e.game.events.Trigger("OnAddCollisionObject",{object:t})):(e.game.events.Trigger("OnAddWorldObject",{object:t}),t.userData.name.includes("glass")&&(t.material=e.glassMaterial,t.geometry.computeVertexNormals()))))})),t.scene.children=t.scene.children.filter((e=>n.indexOf(e)<0)),t.scene.overrideMaterial=new i.vBJ,this.game.scene.add(t.scene),this.game.events.Trigger("OnWorldLoad",{}),s.dispose()}),(e=>{let t=e.loaded/e.total*100;this.game.events.Trigger("WorldLoadProgress",{progress:t})}),(e=>console.error(e)))}Load(e,t,s,i,n){e.load(t,s,i,n)}GetAssetPath(){return"assets/"+this.ASSET_VERSION+"/"}}const v=function(e,t){return[e+"px"+t,e+"nx"+t,e+"py"+t,e+"ny"+t,e+"pz"+t,e+"nz"+t]};var w=s(5615),y=s(3172);const b="undefined"!=typeof window&&window.THREE?window.THREE:{LinearFilter:i.wem,Sprite:i.jyi,SpriteMaterial:i.xeV,Texture:i.xEZ};class E extends b.Sprite{constructor(e="",t=10,s="rgba(255, 255, 255, 1)"){super(new b.SpriteMaterial({map:new b.Texture})),this._text=`${e}`,this._textHeight=t,this._color=s,this._backgroundColor=!1,this._padding=0,this._borderWidth=0,this._borderRadius=0,this._borderColor="white",this._strokeWidth=0,this._strokeColor="white",this._fontFace="Arial",this._fontSize=90,this._fontWeight="normal",this._canvas=document.createElement("canvas"),this._texture=this.material.map,this._texture.minFilter=b.LinearFilter,this._genCanvas()}get text(){return this._text}set text(e){this._text=e,this._genCanvas()}get textHeight(){return this._textHeight}set textHeight(e){this._textHeight=e,this._genCanvas()}get color(){return this._color}set color(e){this._color=e,this._genCanvas()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){this._backgroundColor=e,this._genCanvas()}get padding(){return this._padding}set padding(e){this._padding=e,this._genCanvas()}get borderWidth(){return this._borderWidth}set borderWidth(e){this._borderWidth=e,this._genCanvas()}get borderRadius(){return this._borderRadius}set borderRadius(e){this._borderRadius=e,this._genCanvas()}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor=e,this._genCanvas()}get fontFace(){return this._fontFace}set fontFace(e){this._fontFace=e,this._genCanvas()}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e,this._genCanvas()}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight=e,this._genCanvas()}get strokeWidth(){return this._strokeWidth}set strokeWidth(e){this._strokeWidth=e,this._genCanvas()}get strokeColor(){return this._strokeColor}set strokeColor(e){this._strokeColor=e,this._genCanvas()}_genCanvas(){const e=this._canvas,t=e.getContext("2d"),s=Array.isArray(this.borderWidth)?this.borderWidth:[this.borderWidth,this.borderWidth],i=s.map((e=>e*this.fontSize*.1)),n=(Array.isArray(this.borderRadius)?this.borderRadius:[this.borderRadius,this.borderRadius,this.borderRadius,this.borderRadius]).map((e=>e*this.fontSize*.1)),o=Array.isArray(this.padding)?this.padding:[this.padding,this.padding],r=o.map((e=>e*this.fontSize*.1)),a=this.text.split("\n"),h=`${this.fontWeight} ${this.fontSize}px ${this.fontFace}`;t.font=h;const c=Math.max(...a.map((e=>t.measureText(e).width))),l=this.fontSize*a.length;if(e.width=c+2*i[0]+2*r[0],e.height=l+2*i[1]+2*r[1],this.borderWidth){if(t.strokeStyle=this.borderColor,i[0]){const s=i[0]/2;t.lineWidth=i[0],t.beginPath(),t.moveTo(s,n[0]),t.lineTo(s,e.height-n[3]),t.moveTo(e.width-s,n[1]),t.lineTo(e.width-s,e.height-n[2]),t.stroke()}if(i[1]){const s=i[1]/2;t.lineWidth=i[1],t.beginPath(),t.moveTo(Math.max(i[0],n[0]),s),t.lineTo(e.width-Math.max(i[0],n[1]),s),t.moveTo(Math.max(i[0],n[3]),e.height-s),t.lineTo(e.width-Math.max(i[0],n[2]),e.height-s),t.stroke()}if(this.borderRadius){const s=Math.max(...i),o=s/2;t.lineWidth=s,t.beginPath(),[!!n[0]&&[n[0],o,o,n[0]],!!n[1]&&[e.width-n[1],e.width-o,o,n[1]],!!n[2]&&[e.width-n[2],e.width-o,e.height-o,e.height-n[2]],!!n[3]&&[n[3],o,e.height-o,e.height-n[3]]].filter((e=>e)).forEach((([e,s,i,n])=>{t.moveTo(e,i),t.quadraticCurveTo(s,i,s,n)})),t.stroke()}}this.backgroundColor&&(t.fillStyle=this.backgroundColor,this.borderRadius?(t.beginPath(),t.moveTo(i[0],n[0]),[[i[0],n[0],e.width-n[1],i[1],i[1],i[1]],[e.width-i[0],e.width-i[0],e.width-i[0],i[1],n[1],e.height-n[2]],[e.width-i[0],e.width-n[2],n[3],e.height-i[1],e.height-i[1],e.height-i[1]],[i[0],i[0],i[0],e.height-i[1],e.height-n[3],n[0]]].forEach((([e,s,i,n,o,r])=>{t.quadraticCurveTo(e,n,s,o),t.lineTo(i,r)})),t.closePath(),t.fill()):t.fillRect(i[0],i[1],e.width-2*i[0],e.height-2*i[1])),t.translate(...i),t.translate(...r),t.font=h,t.fillStyle=this.color,t.textBaseline="bottom";const d=this.strokeWidth>0;d&&(t.lineWidth=this.strokeWidth*this.fontSize/10,t.strokeStyle=this.strokeColor),a.forEach(((e,s)=>{const i=(c-t.measureText(e).width)/2,n=(s+1)*this.fontSize;d&&t.strokeText(e,i,n),t.fillText(e,i,n)})),this._texture.image=e,this._texture.needsUpdate=!0;const m=this.textHeight*a.length+2*s[1]+2*o[1];this.scale.set(m*e.width/e.height,m,0)}clone(){return new this.constructor(this.text,this.textHeight,this.color).copy(this)}copy(e){return b.Sprite.prototype.copy.call(this,e),this.color=e.color,this.backgroundColor=e.backgroundColor,this.padding=e.padding,this.borderWidth=e.borderWidth,this.borderColor=e.borderColor,this.fontFace=e.fontFace,this.fontSize=e.fontSize,this.fontWeight=e.fontWeight,this.strokeWidth=e.strokeWidth,this.strokeColor=e.strokeColor,this}}class f extends n{Init(){this.geometry=new i.xo$(.25,32,32),this.socket=(0,w.io)(),this.sId="",this.name,this.clientMeshes={},this.socket.on("connect",(function(){console.log("Connected.")})),this.socket.on("disconnect",(function(e){console.log("Disconnected: "+e)})),this.socket.on("login",(e=>{this.name=e.name,console.log("Logged in with name "+e.name),this.game.events.Trigger("Login",{}),setInterval((()=>{this.socket.emit("update",{position:this.game.movement.controls.getObject().position,name:this.name})}))})),this.socket.on("id",(e=>{this.sId=e,this.name&&this.socket.emit("name",{name:this.name})})),this.game.events.RegisterEventListener("NameAdd",this,(({name:e})=>{this.socket.emit("name",{name:e})})),this.socket.on("clients",(e=>{Object.keys(e).forEach((t=>{if(this.clientMeshes[t]||t===this.sId){if(e[t].position&&t!==this.sId){let s=this.clientMeshes[t].position,i=e[t].position;new y.w.Tween(s).to(i,50).onUpdate((()=>{this.clientMeshes[t].position.x=s.x,this.clientMeshes[t].position.y=s.y,this.clientMeshes[t].position.z=s.z})).start()}}else{const s=new i.ZAu,n=new i.xoR({color:new i.Ilk(`rgb(${e[t].color.r}, ${e[t].color.g}, ${e[t].color.b})`)});n.opacity=.3,n.transparent=!0;const o=new i.Kj0(this.geometry,n);if(s.add(o),e[t].name.length>0){const i=new E(e[t].name);i.fontFace="Helvetica Neue",i.fontSize=200;let n=1e3;i.scale.set(i._canvas.width/n,i._canvas.height/n,1),i.position.y=.4,s.add(i)}s.name=t,this.clientMeshes[t]=s,this.game.scene.add(this.clientMeshes[t])}}))})),this.socket.on("removeClient",(e=>{this.game.scene.remove(this.game.scene.getObjectByName(e))}))}}class L extends n{Init(){this.objects=[],this.objectGroups={},this.ENABLED=!1,this.game.events.RegisterEventListener("OnAddWorldObject",this,(({object:e})=>{if(e.userData.name.includes("poster")&&this.objects.push(e),e.userData.name.includes("ex:")){this.objects.push(e);let t=this.GetSlug(e);this.objectGroups[t]||(this.objectGroups[t]=[]),this.objectGroups[t].push(e)}})),this.game.events.RegisterEventListener("OnObjectClick",this,(({object:e,slug:t})=>{e.userData.name.includes("poster")&&open("https://deshowcase.london/events/"+t)})),this.mouse=new i.FM8,window.addEventListener("mousemove",(e=>{this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-e.clientY/window.innerHeight*2+1})),this.raycaster=new i.iMs(new i.Pa4,new i.Pa4(0,-1,0),0,5),this.selectedObject=null,this.game.events.RegisterEventListener("OnObjectMouseOver",this,(()=>{document.body.style.cursor="pointer",document.getElementById("crosshair").style.fontSize="35px"})),this.game.events.RegisterEventListener("OnObjectMouseLeave",this,(()=>{document.body.style.cursor="",document.getElementById("crosshair").style.fontSize="20px"})),this.game.events.RegisterEventListener("ControlsEnable",this,(()=>{this.ENABLED=!0})),this.game.events.RegisterEventListener("ControlsDisable",this,(()=>{this.ENABLED=!1,document.body.style.cursor=""})),this.clickObject,window.addEventListener("mousedown",(e=>{0===e.button&&this.selectedObject&&(this.clickObject=this.selectedObject)})),window.addEventListener("mouseup",(e=>{0===e.button&&this.ENABLED&&this.game.movement.controls.isLocked&&this.selectedObject&&this.selectedObject===this.clickObject&&(this.game.events.Trigger("OnObjectClick",{object:this.selectedObject,slug:this.GetSlug(this.selectedObject)}),document.body.style.cursor=""),this.clickObject=null}))}GetSlug(e){return e.userData.name.split(":")[1]}Update(){if(!this.ENABLED)return;this.raycaster.setFromCamera({x:0,y:0},this.game.camera);const e=this.raycaster.intersectObjects(this.objects,!0);if(e.length>0){if(this.selectedObject!==e[0].object){this.selectedObject=e[0].object;let t=this.GetSlug(this.selectedObject);this.game.events.Trigger("OnObjectMouseOver",{object:this.selectedObject,objects:this.objectGroups[t],slug:t})}}else this.selectedObject&&(this.game.events.Trigger("OnObjectMouseLeave",{}),this.selectedObject=null)}}var x=s(1125),k=function(e,t){void 0===t&&(console.warn('THREE.PointerLockControls: The second parameter "domElement" is now mandatory.'),t=document.body),this.domElement=t,this.ENABLED=!1,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI;var s=this,n={type:"change"},o={type:"lock"},r={type:"unlock"},a=new i.USm(0,0,0,"YXZ"),h=Math.PI/2,c=new i.Pa4;let l=!1;function d(e){0===e.button&&(l=!0)}function m(e){0===e.button&&(l=!1)}let g=e=>{if(this.ENABLED&&!1!==s.isLocked){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||0;this.RotateCamera(-t,-i)}};function u(){s.domElement.ownerDocument.pointerLockElement===s.domElement?(s.dispatchEvent(o),s.isLocked=!0):(s.dispatchEvent(r),s.isLocked=!1)}function p(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}var v;this.RotateCamera=(t,i)=>{a.setFromQuaternion(e.quaternion),a.y-=.0015*-t,a.x-=.0015*-i,a.x=Math.max(h-s.maxPolarAngle,Math.min(h-s.minPolarAngle,a.x)),e.quaternion.setFromEuler(a),s.dispatchEvent(n)},this.Enable=function(){this.ENABLED=!0},this.Disable=function(){this.ENABLED=!1,this.unlock()},this.connect=function(){s.domElement.ownerDocument.addEventListener("mousemove",g),s.domElement.ownerDocument.addEventListener("mousedown",d),s.domElement.ownerDocument.addEventListener("mouseup",m),s.domElement.ownerDocument.addEventListener("pointerlockchange",u),s.domElement.ownerDocument.addEventListener("pointerlockerror",p)},this.disconnect=function(){s.domElement.ownerDocument.removeEventListener("mousemove",g),s.domElement.ownerDocument.removeEventListener("mousedown",d),s.domElement.ownerDocument.addremoveEventListenerEventListener("mouseup",m),s.domElement.ownerDocument.removeEventListener("pointerlockchange",u),s.domElement.ownerDocument.removeEventListener("pointerlockerror",p)},this.dispose=function(){this.disconnect()},this.getObject=function(){return e},this.getDirection=(v=new i.Pa4(0,0,-1),function(t){return t.copy(v).applyQuaternion(e.quaternion)}),this.moveForward=function(t){c.setFromMatrixColumn(e.matrix,0),c.crossVectors(e.up,c),e.position.addScaledVector(c,t)},this.moveRight=function(t){c.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(c,t)},this.lock=function(){this.domElement.requestPointerLock()},this.unlock=function(){s.domElement.ownerDocument.exitPointerLock()},this.connect()};(k.prototype=Object.create(i.pBf.prototype)).constructor=k;class O extends n{Init(){this.controls=new k(this.game.camera,document.body),this.game.scene.add(this.controls.getObject()),this.panSpeed=0,this.panMaxSpeed=10,this.panAccel=80,this.movement={forward:!1,back:!1,left:!1,panLeft:!1,right:!1,panRight:!1,velocity:new i.Pa4,direction:new i.Pa4,axisDirection:new i.Pa4,cameraDirection:new i.Pa4,u:new i.Pa4(0,1,0),f:new i.Pa4(1,0,0),d:new i.Pa4(0,-1,0)},this.movementSettings={groundAccel:20,maxVelGround:3,friction:10},this.nextPosition=this.controls.getObject().position.clone(),this.shouldClamp=!1,this.game.collision.world.addEventListener("postStep",(()=>{let{x:e,y:t,z:s}=this.game.collision.player.position;this.controls.getObject().position.set(e,t,s),this.shouldClamp&&(this.game.collision.player.velocity.set(0,0,0),this.shouldClamp=!1)})),this.game.collision.world.addEventListener("beginContact",(()=>{this.shouldClamp=!0})),this.ENABLED=!1,this.LOCK_ENABLED=!1,this.game.events.RegisterEventListener("Move",this,(({move:e,down:t})=>{this.movement[e]=t})),this.game.events.RegisterEventListener("ControlsEnable",this,(()=>{this.ENABLED=!0,this.controls.Enable()})),this.game.events.RegisterEventListener("ControlsDisable",this,(()=>{this.ENABLED=!1,this.controls.Disable()})),this.game.events.RegisterEventListener("ControlsLockEnable",this,(()=>{this.LOCK_ENABLED=!0})),this.game.events.RegisterEventListener("ControlsLockDisable",this,(()=>{this.LOCK_ENABLED=!1})),document.getElementById("blocker").addEventListener("click",(()=>{this.LOCK_ENABLED&&this.controls.lock()})),document.getElementById("modal-screen").addEventListener("click",(()=>{this.LOCK_ENABLED&&this.controls.lock()})),this.controls.addEventListener("lock",(()=>{document.getElementById("crosshair").style.display="block",this.game.events.Trigger("HideInstructions",{}),this.game.events.Trigger("ControlsEnable",{})})),this.controls.addEventListener("unlock",(()=>{document.getElementById("crosshair").style.display="none",this.game.events.Trigger("ShowInstructions",{}),this.game.events.Trigger("ControlsDisable",{})})),this.game.events.Trigger("GeneratePlayerCollider",{})}Update(e){let t=0;this.ENABLED&&(this.movement.panLeft&&(t+=1),this.movement.panRight&&(t+=-1)),this.panSpeed+=t*e*this.panAccel,0==t&&(this.panSpeed>0&&(this.panSpeed=Math.max(this.panSpeed-this.panAccel*e,0)),this.panSpeed<0&&(this.panSpeed=Math.min(this.panSpeed+this.panAccel*e,0))),this.panSpeed=Math.min(Math.max(this.panSpeed,-this.panMaxSpeed),this.panMaxSpeed),this.controls.RotateCamera(this.panSpeed,0),this.GetMovementDirection(),this.movement.velocity=this.MoveGround(this.movement.direction,this.movement.velocity,e);let{x:s,y:i,z:n}=this.movement.velocity;this.game.collision.player.velocity.set(s,i,n)}THREE2CANNON(e){let{x:t,y:s,z:i}=e;return new x.Vec3(t,s,i)}CANNON2THREE(e){let{x:t,y:s,z:n}=e;return new i.Pa4(t,s,n)}GetMovementDirection(){if(!this.ENABLED)return void this.movement.direction.set(0,0,0);let{u:e,f:t}=this.movement;this.movement.cameraDirection.setFromMatrixColumn(this.controls.getObject().matrix,0),this.movement.cameraDirection.crossVectors(this.controls.getObject().up,this.movement.cameraDirection);let s=Number(this.movement.forward)-Number(this.movement.back),i=Number(this.movement.right)-Number(this.movement.left);if(this.movement.axisDirection.set(s,0,i),this.movement.axisDirection.normalize(),0===s&&0==i)this.movement.direction.set(0,0,0);else{this.movement.direction.copy(this.movement.cameraDirection);let s=Math.atan2(this.movement.axisDirection.x*t.z-this.movement.axisDirection.z*t.x,this.movement.axisDirection.x*t.x+this.movement.axisDirection.z*t.z);this.movement.direction.applyAxisAngle(e,s)}}Accelerate(e,t,s,i,n){let o=t.dot(e),r=s*n;return o+r>i&&(r=i-o),t.add(e.multiplyScalar(r))}MoveGround(e,t,s){let i=t.length();if(0!=i){let e=i*this.movementSettings.friction*s;t.multiplyScalar(Math.max(i-e,0)/i)}return this.Accelerate(e,t,this.movementSettings.groundAccel,this.movementSettings.maxVelGround,s)}}class C extends n{Init(){window.addEventListener("keydown",(e=>this.Key(!0,e.code))),window.addEventListener("keyup",(e=>this.Key(!1,e.code)))}Key(e,t){switch(t){case"ArrowUp":case"KeyW":this.game.events.Trigger("Move",{move:"forward",down:e});break;case"ArrowLeft":this.game.events.Trigger("Move",{move:"panLeft",down:e});break;case"KeyA":this.game.events.Trigger("Move",{move:"left",down:e});break;case"ArrowDown":case"KeyS":this.game.events.Trigger("Move",{move:"back",down:e});break;case"ArrowRight":this.game.events.Trigger("Move",{move:"panRight",down:e});break;case"KeyD":this.game.events.Trigger("Move",{move:"right",down:e})}}}class S extends n{Init(){this.slug,this.cache={},this.game.events.RegisterEventListener("OnObjectClick",this,(({object:e,slug:t})=>{if(e.userData.name.includes("ex:"))if(this.slug=t,t='"'+t+'"',this.cache[this.slug])this.game.events.Trigger("OpenModalWithContents",{slug:this.slug,data:this.cache[this.slug]});else{this.game.events.Trigger("OpenModal",{});let e=`\n\t\t\t\t{\n\t\t\t\t\tentries(siteId: 1, section: "project", slug: ${t}, orderBy: "title ASC") {\n\t\t\t\t\t  ... on project_project_Entry {\n\t\t\t\t\t\ttitle\n\t\t\t\t\t\turl\n\t\t\t\t\t\tthumbnail {\n \t\t\t\t\t\t\t... on static_Asset {\n \t\t\t\t\t\t\turl\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t}\n\t\t\t\t\t\tcontributors {\n\t\t\t\t\t\t  ... on person_person_Entry {\n\t\t\t\t\t\t\ttitle\n\t\t\t\t\t\t  }\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdescription\n\t\t\t\t\t  }\n\t\t\t\t\t}\n\t\t\t\t  }`,s=JSON.stringify({query:e,variables:{}});fetch("https://deshowcase.london/api",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer vuxMlpBoejc4a5JGVa7cDzKTT7Wc8Yr4"},body:s}).then((e=>e.json())).then((e=>e.errors?(e.errors.forEach((e=>{console.warn(e.message)})),void this.game.events.Trigger("SetErrorModal",{message:"An unexpected error occurred when trying to fetch this project."})):e.data&&e.data.entries&&0===e.data.entries.length?(console.warn("No data entries received."),void this.game.events.Trigger("SetErrorModal",{message:"This project could not be found."})):(this.cache[this.slug]=e,void this.game.events.Trigger("SetModalContents",{data:e,slug:this.slug})))).catch((e=>console.error(e)))}})),this.game.events.RegisterEventListener("FetchProjectNames",this,(()=>{let e=JSON.stringify({query:'\n\t\t\t\t{\n\t\t\t\t\tentries(siteId: 1, section: "project", orderBy: "title ASC") {\n\t\t\t\t\t  ... on project_project_Entry {\n\t\t\t\t\t\ttitle\n\t\t\t\t\t\tslug\n\t\t\t\t\t\tcontributors {\n\t\t\t\t\t\t\t... on person_person_Entry {\n\t\t\t\t\t\t\t  title\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t  }\n\t\t\t\t\t  }\n\t\t\t\t\t}\n\t\t\t\t  }',variables:{}});fetch("https://deshowcase.london/api",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer vuxMlpBoejc4a5JGVa7cDzKTT7Wc8Yr4"},body:e}).then((e=>e.json())).then((e=>{e.errors?e.errors.forEach((e=>{console.warn(e.message)})):e.data&&e.data.entries&&0===e.data.entries.length?console.warn("No data entries received."):this.game.events.Trigger("LoadProjectNames",{data:e})})).catch((e=>console.error(e)))}))}}var M=s(2389);class _ extends n{Init(e,t){this.name=e,this.element=document.getElementById(e+"-screen"),this.easing=M(0,0,.2,1),this.display=t,this.NUKED=!1,this.opacity={value:0},this.element.style.opacity=this.opacity.value}Show(){this.NUKED||(this.tween&&this.tween.stop(),this.tween=new y.w.Tween(this.opacity).to({value:1},200).easing(y.w.Easing.Cubic.In).onStart((()=>{this.element.style.display=this.display,this.element.opacity=0})).onUpdate((()=>{this.element.style.opacity=this.opacity.value})).onComplete((()=>{this.game.events.Trigger(this.name+"FadeIn",{})})).start())}Hide(){this.NUKED?this.element.style.display="none":(this.tween&&this.tween.stop(),this.tween=new y.w.Tween(this.opacity).to({value:0},200).easing(y.w.Easing.Cubic.Out).onUpdate((()=>{this.element.style.opacity=this.opacity.value})).onComplete((()=>{this.element.style.display="none",this.game.events.Trigger(this.name+"FadeOut",{})})).start())}}class T extends _{Init(){super.Init("loading","flex"),this.opacity={value:1},this.element.style.opacity=this.opacity.value,this.blocker=document.getElementById("blocker"),this.game.events.RegisterEventListener("WorldLoadProgress",this,(({progress:e})=>{document.getElementById("progress-bar").style.width=e+"%"})),this.game.events.RegisterEventListener("AssetCacheHit",this,(({key:e})=>{e.includes("scene")&&(document.getElementById("progress-bar").style.width="100%")})),this.game.events.RegisterEventListener("OnWorldLoad",this,(()=>{this.Hide();let e=1,t=setInterval((()=>{e<=0&&clearInterval(t),this.blocker.style.backgroundColor=`rgba(255, 255, 255, ${this.easing(e)})`,e-=.05}),10);this.game.events.Trigger("ScreenBlurOn",{})}))}}class j extends _{Init(){super.Init("name","flex"),this.input=document.getElementById("name-input"),this.button=document.getElementById("form-submit"),this.form=document.getElementById("name-form"),this.hint=document.getElementById("name-hint"),this.CHARACTER_LIMIT=20,this.LOCKED=!1,this.game.events.RegisterEventListener("loadingFadeOut",this,(()=>{this.Show(),window.setTimeout((()=>{this.input.focus()}),100)})),document.getElementById("name-form").addEventListener("submit",(e=>(e.preventDefault(),this.LOCKED||(console.log("Sending login request"),this.input.disabled=!0,this.button.disabled=!0,this.hint.innerHTML="Logging in...",this.game.events.Trigger("NameAdd",{name:this.input.value}),this.LOCKED=!0),!1))),this.game.events.RegisterEventListener("Login",this,(()=>{this.game.events.Trigger("ControlsLockEnable",{}),this.game.events.Trigger("ScreenBlurOff",{}),this.game.events.Trigger("ShowInstructions",{}),this.Hide()}))}Show(){super.Show(),this.pressHandler=this.input.addEventListener("input",(e=>{let t=e.target.value;t.length>this.CHARACTER_LIMIT&&(t=t.substring(0,this.CHARACTER_LIMIT)),t=this.ToTitleCase(t),/^[a-zA-Z\s]*$/.test(t)?(this.hint.innerHTML=this.CHARACTER_LIMIT-t.length+"/20 remaining",this.hint.classList.remove("error")):(this.hint.innerHTML="Only letters and spaces allowed",this.hint.classList.add("error")),e.target.value=t}))}ToTitleCase(e){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}Hide(){super.Hide(),this.input.removeEventListener("input",this.pressHandler)}}class A extends _{Init(){super.Init("instructions","block"),this.game.events.RegisterEventListener("ShowInstructions",this,(()=>{this.Show()})),this.game.events.RegisterEventListener("HideInstructions",this,(()=>{this.Hide()})),this.game.events.RegisterEventListener("NukeInstructions",this,(()=>{this.NUKED=!0,this.Hide()})),this.game.events.RegisterEventListener("UnNukeInstructions",this,(()=>{this.NUKED=!1}))}}class I extends _{Init(){super.Init("escape","flex"),this.game.movement.controls.addEventListener("lock",(()=>{this.Show()})),this.game.movement.controls.addEventListener("unlock",(()=>{this.Hide()}))}}class R extends _{Init(){super.Init("info","block"),this.name=document.getElementById("info-name"),this.author=document.getElementById("info-author"),this.names={},this.OPEN=!1,this.game.events.RegisterEventListener("LoadProjectNames",this,(({data:e})=>{e.data.entries.forEach((e=>{this.names[e.slug]={title:e.title,authors:this.GetNameString(e.contributors)}}))})),this.game.events.RegisterEventListener("OnObjectMouseOver",this,(({slug:e})=>{this.names[e]&&(this.name.innerHTML=this.names[e].title,this.author.innerHTML=this.names[e].authors,this.Show(),this.OPEN=!0)})),this.game.events.RegisterEventListener("OnObjectMouseLeave",this,(()=>{this.Hide(),this.OPEN=!1})),this.game.movement.controls.addEventListener("lock",(()=>{this.OPEN&&this.Show()})),this.game.movement.controls.addEventListener("unlock",(()=>{this.Hide()})),this.game.events.RegisterEventListener("NukeInstructions",this,(()=>{this.NUKED=!0,this.Hide()})),this.game.events.RegisterEventListener("UnNukeInstructions",this,(()=>{this.NUKED=!1}))}GetNameString(e){let t="by ";for(let s=0;s<e.length;s++)t+=e[s].title+", ";return t.slice(0,-2)}}class D extends _{Init(){super.Init("modal","flex"),this.blocker=document.getElementById("blocker"),this.loading=document.getElementById("modal-loading"),this.contents=document.getElementById("modal-contents"),this.image=document.getElementById("modal-image"),this.body=document.getElementById("modal-body"),this.error=document.getElementById("modal-error"),this.title=document.getElementById("modal-title"),this.author=document.getElementById("modal-author"),this.desc=document.getElementById("modal-desc"),this.link=document.getElementById("modal-link"),this.close=document.getElementById("modal-close"),this.close.addEventListener("click",(e=>{this.Hide()})),this.game.events.RegisterEventListener("OpenModal",this,(()=>{this.OpenModalLoading()})),this.game.events.RegisterEventListener("OpenModalWithContents",this,(({data:e,slug:t})=>{this.OpenModalWithContents(e,t)})),this.game.events.RegisterEventListener("SetModalContents",this,(({data:e,slug:t})=>{this.contents.style.maxHeight="500px",this.SetModalContents(e,t),this.Loaded()})),this.game.events.RegisterEventListener("SetErrorModal",this,(({message:e})=>{this.Error(e)}))}OpenModalLoading(){this.Loading(),this.Show()}OpenModalWithContents(e,t){this.contents.classList.add("notransition"),this.contents.style.maxHeight="500px",this.contents.offsetHeight,this.contents.classList.remove("notransition"),this.SetModalContents(e,t),this.Loaded(),this.Show()}Loading(){this.contents.classList.add("notransition"),this.contents.style.maxHeight="100px",this.contents.offsetHeight,this.contents.classList.remove("notransition"),this.loading.style.display="block",this.image.style.display="none",this.body.style.display="none",this.error.style.display="none"}Loaded(){this.contents.style.maxHeight="500px",this.loading.style.display="none",this.image.style.display="block",this.body.style.display="block",this.error.style.display="none"}Error(e){this.loading.style.display="none",this.image.style.display="none",this.body.style.display="none",this.error.style.display="block",this.error.innerHTML=e}SetModalContents(e,t){let s=e.data.entries[0];this.image.style.backgroundImage=`url("${s.thumbnail[0].url}")`,this.title.innerHTML=s.title,this.author.innerHTML=this.GetNameString(s.contributors),this.desc.innerHTML=this.Truncate(s.description,150,!0),this.link.href=s.url}Show(){super.Show(),this.blocker.style.display="none",this.handler=e=>{0===e.button&&this.Hide()},this.escHandler=e=>{"Escape"===e.code&&(this.game.events.Trigger("UnNukeInstructions",{}),this.game.instructionsScreen.Show(),this.Hide())},document.addEventListener("keydown",this.escHandler),this.game.events.Trigger("NukeInstructions",{}),this.game.events.Trigger("ScreenBlurOn",{}),this.game.events.Trigger("ControlsDisable",{}),this.game.events.Trigger("ControlsLockDisable",{})}Hide(){super.Hide(),this.blocker.style.display="flex",document.removeEventListener("keydown",this.escHandler),this.game.events.Trigger("UnNukeInstructions",{}),this.game.events.Trigger("ControlsEnable",{}),this.game.events.Trigger("ControlsLockEnable",{}),this.game.events.Trigger("ScreenBlurOff",{})}GetNameString(e){let t="";for(let s=0;s<e.length;s++)t+=e[s].title+", ";return t.slice(0,-2)}Truncate(e,t,s){if(e.length<=t)return e;const i=e.substr(0,t-1);return(s?i.substr(0,i.lastIndexOf(" ")):i)+"&hellip;"}}class P extends n{Init(){this.world=new x.World,this.world.gravity.set(0,0,0),this.world.solver.iterations=20,this.world.solver.tolerance=0;let e=new x.Material("material"),t=new x.ContactMaterial(e,e,{friction:10,restitution:0,contactEquationStiffness:1e8,contactEquationRelaxation:1e4,frictionEquationStiffness:1});this.world.addContactMaterial(t),this.game.events.RegisterEventListener("GeneratePlayerCollider",this,(()=>{this.player=new x.Body({mass:1e-5,material:e});let t=new x.Cylinder(.25,.25,1,128);this.player.addShape(t),this.player.quaternion.setFromAxisAngle(new x.Vec3(1,0,0),-Math.PI/2),this.player.fixedRotation=!0,this.player.updateMassProperties(),this.world.addBody(this.player);let{x:s,y:i,z:n}=this.game.camera.position;this.player.position.set(s,i,n)})),this.game.events.RegisterEventListener("OnAddCollisionObject",this,(({object:t})=>{let s=new x.Box(new x.Vec3(t.scale.x,t.scale.y,t.scale.z)),i=new x.Body({mass:0,material:e});i.addShape(s),i.position.copy(t.position),i.quaternion.copy(t.quaternion),this.world.addBody(i)}))}CreateConvex(e){const t=e.attributes.position.array,s=e.index.array;let i=[],n=[];for(let e=0;e<t.length;e+=3)i.push(new x.Vec3(t[e],t[e+1],t[e+2]));for(let e=0;e<s.length;e+=3)n.push([s[e],s[e+1],s[e+2]]);return new x.ConvexPolyhedron(i,n)}}var B=function(e,t,s){s=s||{},this.scene=e,this.world=t,this._meshes=[],this._boxMaterial=new i.vBJ({color:255,wireframe:!0}),this._triMaterial=new i.vBJ({color:16711680,wireframe:!0}),this._sphereMaterial=new i.vBJ({color:65280,wireframe:!0}),this._sphereGeometry=new i.xo$(1),this._boxGeometry=new i.DvJ(1,1,1),this._planeGeometry=new i._12(10,10,10,10),this._cylinderGeometry=new i.fHI(1,1,10,10)};B.prototype={tmpVec0:new x.Vec3,tmpVec1:new x.Vec3,tmpVec2:new x.Vec3,tmpQuat0:new x.Vec3,update:function(){for(var e=this.world.bodies,t=this._meshes,s=this.tmpVec0,i=this.tmpQuat0,n=0,o=0;o!==e.length;o++)for(var r=e[o],a=0;a!==r.shapes.length;a++){var h=r.shapes[a];this._updateMesh(n,r,h),(c=t[n])&&(r.quaternion.vmult(r.shapeOffsets[a],s),r.position.vadd(s,s),r.quaternion.mult(r.shapeOrientations[a],i),c.position.copy(s),c.quaternion.copy(i)),n++}for(o=n;o<t.length;o++){var c;(c=t[o])&&this.scene.remove(c)}t.length=n},_updateMesh:function(e,t,s){var i=this._meshes[e];this._typeMatch(i,s)||(i&&this.scene.remove(i),i=this._meshes[e]=this._createMesh(s)),this._scaleMesh(i,s)},_typeMatch:function(e,t){if(!e)return!1;var s=e.geometry;return s instanceof i.xo$&&t instanceof x.Sphere||s instanceof i.DvJ&&t instanceof x.Box||s instanceof i._12&&t instanceof x.Plane||s.id===t.geometryId&&t instanceof x.ConvexPolyhedron||s.id===t.geometryId&&t instanceof x.Trimesh||s.id===t.geometryId&&t instanceof x.Heightfield},_createMesh:function(e){var t,s=this._sphereMaterial,n=this._boxMaterial;switch(this._triMaterial,e.type){case x.Shape.types.SPHERE:t=new i.Kj0(this._sphereGeometry,s);break;case x.Shape.types.BOX:t=new i.Kj0(this._boxGeometry,n);break;case x.Shape.types.PLANE:t=new i.Kj0(this._planeGeometry,s);break;case x.Shape.types.CONVEXPOLYHEDRON:const o=new i.u9r;let r=[];for(let t=0;t<e.vertices.length;t++){let s=e.vertices[t];r.push(s.x),r.push(s.y),r.push(s.z)}let a=[];for(let t=0;t<e.faces.length;t++){let s=e.faces[t];a.push(s[0]),a.push(s[1]),a.push(s[2])}o.setIndex(a),o.setAttribute("position",new i.a$l(r,3)),t=new i.Kj0(o,n),e.geometryId=o.id;break;case x.Shape.types.TRIMESH:}return t&&this.scene.add(t),t},_scaleMesh:function(e,t){switch(t.type){case x.Shape.types.SPHERE:var s=t.radius;e.scale.set(s,s,s);break;case x.Shape.types.BOX:e.scale.copy(t.halfExtents),e.scale.multiplyScalar(2);break;case x.Shape.types.CONVEXPOLYHEDRON:case x.Shape.types.TRIMESH:break;case x.Shape.types.HEIGHTFIELD:e.scale.set(1,1,1)}},clearMeshes:function(){this._meshes.forEach((e=>{this.scene.remove(e)}))}};let H=new class extends class{constructor(){this.gameObjects=[],this.events=new o,this.container=document.createElement("div"),document.body.appendChild(this.container),this.renderer=new i.CP7({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.container.appendChild(this.renderer.domElement),this.camera=new i.cPb(80,window.innerWidth/window.innerHeight,.01,2e3),this.scene=new i.xsS,this.scene.add(new i.Mig(16777215,1)),this.clock=new i.SUY,window.addEventListener("resize",(()=>{const e=window.innerWidth,t=window.innerHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}))}AddGameObject(e){return-1===this.gameObjects.indexOf(e)&&(this.gameObjects.push(e),e.Add(this)),e}RemoveGameObject(e){let t=this.gameObjects.indexOf(e);t>-1&&(this.gameObjects.splice(t,1),e.Remove())}}{constructor(){super(),this.camera.lookAt(new i.Pa4(-1,0,0)),this.camera.position.set(13,1.6,-.75),this.AddGameObject(new p(4)),this.postProcessing=this.AddGameObject(new d),this.input=this.AddGameObject(new C),this.collision=this.AddGameObject(new P),this.movement=this.AddGameObject(new O),this.select=this.AddGameObject(new L),this.loadingScreen=this.AddGameObject(new T),this.nameScreen=this.AddGameObject(new j),this.instructionsScreen=this.AddGameObject(new A),this.escapeScreen=this.AddGameObject(new I),this.infoScreen=this.AddGameObject(new R),this.modal=this.AddGameObject(new D),this.renderer.domElement.style.touchAction="none",this.events.RegisterEventListener("ScreenBlurOn",this,(()=>{this.renderer.domElement.style.filter="blur(20px)"})),this.events.RegisterEventListener("ScreenBlurOff",this,(()=>{this.renderer.domElement.style.filter="blur(0px)"})),this.events.RegisterEventListener("OnWorldLoad",this,(()=>{this.multiplayer=this.AddGameObject(new f),this.ui=this.AddGameObject(new S),this.events.Trigger("FetchProjectNames",{})})),this.debug=new B(this.scene,this.collision.world,{}),this.dt=.1}Update(e){y.w.update();let t=Math.min(this.dt,e);this.movement.Update(t),this.collision.world.step(t/2),this.collision.world.step(t/2),this.select.Update(),this.postProcessing.Update()}};!function e(){requestAnimationFrame(e);const t=H.clock.getDelta();H.Update(t)}()}},e=>{"use strict";e.O(0,[765,708,471,756,447,966,115,208,675,731,701,362,304,813,343,71,803],(()=>(3352,e(e.s=3352)))),e.O()}]);